<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ahorro Challenge</title>
    
    <link rel="manifest" href="./manifest.json">
    
    <link rel="icon" type="image/png" href="https://i.ibb.co/m5p3Srk/image.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co/m5p3Srk/image.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ahorro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#10b981">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#10b981', secondary: '#0ea5e9', background: '#f8fafc' },
                    fontFamily: { display: ['Outfit', 'sans-serif'], body: ['Plus Jakarta Sans', 'sans-serif'] },
                }
            }
        }
    </script>
    <style>
        body { background: radial-gradient(circle at top right, #f0fdf4, #f8fafc 50%), radial-gradient(circle at bottom left, #eff6ff, #f8fafc 50%); min-height: 100vh; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .badge-active { background: #10b981 !important; color: white !important; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2); }
    </style>
</head>
<body class="font-body text-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-6">
        <header class="mb-8 flex flex-col md:flex-row gap-6 items-start justify-between">
            <div>
                <h1 class="text-3xl font-display font-bold text-slate-900">Ahorro <span class="text-primary">Challenge</span></h1>
                <div class="flex gap-2 mt-2">
                    <button onclick="setStatsView('COLECTIVO')" id="btnViewCol" class="px-3 py-1 text-xs font-bold rounded-full border border-primary text-primary">VISTA COLECTIVA</button>
                    <button onclick="setStatsView('INDIVIDUAL')" id="btnViewInd" class="px-3 py-1 text-xs font-bold rounded-full border border-slate-200 text-slate-400">VISTA INDIVIDUAL</button>
                </div>
            </div>
            <div class="glass-card rounded-2xl p-4 flex items-center gap-6 min-w-[280px] border-l-4 border-l-primary shadow-sm">
                <div class="relative w-14 h-14 shrink-0">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="28" cy="28" r="24" stroke="currentColor" stroke-width="5" fill="transparent" class="text-slate-100" />
                        <circle id="globalProgressCircle" cx="28" cy="28" r="24" stroke="currentColor" stroke-width="5" fill="transparent" stroke-dasharray="150.8" stroke-dashoffset="150.8" class="text-primary transition-all duration-700" />
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center text-xs font-bold" id="progressPercentage">0%</div>
                </div>
                <div>
                    <div class="text-[10px] font-bold uppercase text-slate-400" id="statsTitle">Total Colectivo</div>
                    <div class="text-xl font-bold font-display text-slate-900" id="totalSavedCounter">0 Gs.</div>
                    <div class="text-[11px] text-slate-500"><span id="completedCount">0</span> de 52 metas</div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <aside class="space-y-4">
                <div class="glass-card rounded-2xl p-4 shadow-sm">
                    <h2 class="text-sm font-bold mb-3 uppercase tracking-wider text-slate-500">Participantes</h2>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="newParticipantInput" placeholder="Nombre..." class="w-full bg-white border border-slate-200 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-1 focus:ring-primary">
                        <button onclick="addParticipant()" class="bg-primary text-white p-2 rounded-lg hover:bg-emerald-600 transition-colors">+</button>
                    </div>
                    <div id="participantList" class="space-y-1"></div>
                </div>
                <button onclick="confirmReset()" class="w-full py-2 text-xs font-bold text-rose-400 hover:text-rose-600 flex justify-center items-center gap-1">RESETEAR TODO</button>
            </aside>
            <main class="lg:col-span-3">
                <div class="flex overflow-x-auto pb-3 gap-2 no-scrollbar mb-4">
                    <button onclick="filterPhase('ALL')" class="px-4 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-bold">Todas</button>
                    <button onclick="filterPhase('EMPEZAR')" class="px-4 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-bold">Fase 1</button>
                    <button onclick="filterPhase('SOSTENER')" class="px-4 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-bold">Fase 2</button>
                    <button onclick="filterPhase('CONSTANCIA')" class="px-4 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-bold">Fase 3</button>
                    <button onclick="filterPhase('RESULTADOS')" class="px-4 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-bold">Fase 4</button>
                </div>
                <div id="goalsList" class="space-y-2"></div>
            </main>
        </div>
    </div>

    <script>
        let challengeData = []; let participants = []; let activeParticipant = ""; let currentFilter = "ALL"; let statsView = "COLECTIVO";
        const formatPYG = (n) => new Intl.NumberFormat('es-PY').format(n) + ' Gs.';
        function generateWeeks() { challengeData = []; for (let i = 1; i <= 52; i++) { let phase = i <= 13 ? "EMPEZAR" : i <= 26 ? "SOSTENER" : i <= 39 ? "CONSTANCIA" : "RESULTADOS"; challengeData.push({ week: i, amount: i * 10000, phase: phase, completions: [] }); } }
        function save() { localStorage.setItem('ahorro_final_v13', JSON.stringify({ challengeData, participants, activeParticipant, statsView })); }
        function load() { const saved = localStorage.getItem('ahorro_final_v13'); if (saved) { const p = JSON.parse(saved); challengeData = p.challengeData; participants = p.participants; activeParticipant = p.activeParticipant; statsView = p.statsView || "COLECTIVO"; } else { generateWeeks(); } }
        function renderParticipants() { const list = document.getElementById('participantList'); if (participants.length === 0) { list.innerHTML = `<p class="text-[11px] text-slate-400 italic px-2">Agrega un nombre</p>`; return; } list.innerHTML = participants.map(p => `<div class="flex items-center bg-white/50 rounded-lg p-1 border border-transparent hover:border-slate-200"><button onclick="setActiveParticipant('${p}')" class="flex-grow text-left px-3 py-1.5 text-sm font-semibold rounded-md transition-all ${p === activeParticipant ? 'badge-active' : 'text-slate-500'}">${p}</button><button onclick="deleteParticipant('${p}')" class="px-2 text-slate-300 hover:text-rose-500">X</button></div>`).join(''); }
        function addParticipant() { const n = document.getElementById('newParticipantInput').value.trim().toUpperCase(); if (n && !participants.includes(n)) { participants.push(n); if (!activeParticipant) activeParticipant = n; document.getElementById('newParticipantInput').value = ''; save(); renderParticipants(); renderGoals(); updateStats(); } }
        function deleteParticipant(n) { if (confirm(`¿Eliminar a ${n}?`)) { participants = participants.filter(p => p !== n); challengeData.forEach(g => g.completions = g.completions.filter(c => c.participant !== n)); if (activeParticipant === n) activeParticipant = participants[0] || ""; save(); renderParticipants(); renderGoals(); updateStats(); } }
        function setActiveParticipant(n) { activeParticipant = n; save(); renderParticipants(); renderGoals(); updateStats(); }
        function setStatsView(v) { statsView = v; updateStats(); document.getElementById('btnViewCol').className = v === 'COLECTIVO' ? 'px-3 py-1 text-xs font-bold rounded-full border border-primary text-primary' : 'px-3 py-1 text-xs font-bold rounded-full border border-slate-200 text-slate-400'; document.getElementById('btnViewInd').className = v === 'INDIVIDUAL' ? 'px-3 py-1 text-xs font-bold rounded-full border border-primary text-primary' : 'px-3 py-1 text-xs font-bold rounded-full border border-slate-200 text-slate-400'; }
        function toggle(idx) { if (!activeParticipant) return alert("Agrega un nombre"); const g = challengeData[idx]; const cIdx = g.completions.findIndex(c => c.participant === activeParticipant); if (cIdx > -1) g.completions.splice(cIdx, 1); else g.completions.push({ participant: activeParticipant, date: new Date().toLocaleDateString('es-PY') }); save(); renderGoals(); updateStats(); }
        function updateStats() { let t = 0, m = 0; if (statsView === 'COLECTIVO') { t = challengeData.reduce((s, g) => s + (g.completions.length * g.amount), 0); m = challengeData.filter(g => g.completions.length > 0).length; } else { t = challengeData.reduce((s, g) => s + (g.completions.some(c => c.participant === activeParticipant) ? g.amount : 0), 0); m = challengeData.filter(g => g.completions.some(c => c.participant === activeParticipant)).length; } const p = (m / 52) * 100; document.getElementById('totalSavedCounter').innerText = formatPYG(t); document.getElementById('completedCount').innerText = m; document.getElementById('progressPercentage').innerText = Math.round(p) + '%'; document.getElementById('globalProgressCircle').style.strokeDashoffset = 150.8 - (p / 100 * 150.8); }
        function renderGoals() { const container = document.getElementById('goalsList'); const data = currentFilter === 'ALL' ? challengeData : challengeData.filter(g => g.phase === currentFilter); const colors = { 'EMPEZAR': 'bg-emerald-500', 'SOSTENER': 'bg-sky-500', 'CONSTANCIA': 'bg-indigo-500', 'RESULTADOS': 'bg-rose-500' }; container.innerHTML = data.map((g) => { const done = activeParticipant ? g.completions.some(c => c.participant === activeParticipant) : false; return `<div class="glass-card rounded-xl p-2 flex items-center gap-4 border-l-4 ${done ? 'border-l-primary' : 'border-l-slate-200'}"><div class="w-8 h-8 rounded-lg ${colors[g.phase]} flex items-center justify-center text-white text-[10px] font-bold shrink-0">${g.week}</div><div class="flex-grow"><div class="text-sm font-bold text-slate-800">${formatPYG(g.amount)}</div><div class="text-[9px] uppercase text-slate-400 font-bold">${g.phase}</div></div><div class="flex -space-x-2 shrink-0 px-2">${g.completions.map(c => `<div class="h-5 w-5 rounded-full ring-2 ring-white bg-primary text-[8px] flex items-center justify-center text-white font-bold">${c.participant[0]}</div>`).join('')}</div><button onclick="toggle(${g.week - 1})" class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${done ? 'bg-primary text-white' : 'bg-slate-100 text-slate-500'}">${done ? 'LISTO' : 'MARCAR'}</button></div>`; }).join(''); }
        function filterPhase(p) { currentFilter = p; renderGoals(); }
        function confirmReset() { if (confirm("¿Borrar todo?")) { localStorage.clear(); location.reload(); } }
        load(); renderParticipants(); renderGoals(); updateStats(); setStatsView(statsView);
    </script>
</body>
</html>
